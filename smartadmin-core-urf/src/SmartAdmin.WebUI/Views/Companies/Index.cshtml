@model IEnumerable<SmartAdmin.Entity.Models.Company>

@{
    ViewData["Title"] = "企业信息";
    ViewData["PageName"] = "Companies_Index";
    ViewData["Heading"] = "<i class='fal fa-window text-primary'></i> 企业信息";
    ViewData["Category1"] = "组织架构";
    ViewData["PageDescription"] = "";
}
<div class="row">
    <div class="col-lg-12 col-xl-12">
        <div id="panel-1" class="panel">
            <div class="panel-hdr">
                <h2>
                    公司信息
                </h2>
                <div class="panel-toolbar">
                    <button class="btn btn-panel bg-transparent fs-xl w-auto h-auto rounded-0" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"><i class="fal fa-window-minimize"></i></button>
                    <button class="btn btn-panel bg-transparent fs-xl w-auto h-auto rounded-0" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"><i class="fal fa-expand"></i></button>
                </div>

            </div>
            <div class="panel-container show">
                <div class="panel-content py-2 rounded-bottom border-faded border-left-0 border-right-0  text-muted bg-subtlelight-fade ">
                    <div class="row no-gutters align-items-center">
                        <div class="col">
                            <!-- 开启授权控制请参考 @@if (Html.IsAuthorize("Create") -->
                            <div class="btn-group btn-group-sm">
                                <button onclick="append()" class="btn btn-default"> <span class="fal fa-plus mr-1"></span> 新增 </button>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button name="deletebutton" disabled onclick="removeit()" class="btn btn-default"> <span class="fal fa-times mr-1"></span> 删除 </button>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button name="savebutton" disabled onclick="accept()" class="btn btn-default"> <span class="fal fa-save mr-1"></span> 保存 </button>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button name="cancelbutton" disabled onclick="reject()" class="btn btn-default"> <span class="fal fa-ban mr-1"></span> 取消 </button>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button onclick="reload()" class="btn btn-default"> <span class="fal fa-search mr-1"></span> 查询 </button>
                                <button type="button" class="btn btn-default dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu dropdown-menu-animated">
                                    <a class="dropdown-item js-waves-on" href="javascript:void()"> 我的记录 </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item js-waves-on" href="javascript:void()"> 自定义查询 </a>
                                </div>
                            </div>
                            <div class="btn-group btn-group-sm hidden-xs">
                                <button type="button" onclick="importexcel('Company')" class="btn btn-default"><span class="fal fa-cloud-upload mr-1"></span> 导入 </button>
                                <button type="button" class="btn btn-default  dropdown-toggle dropdown-toggle-split waves-effect waves-themed" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu dropdown-menu-animated">
                                    <a class="dropdown-item js-waves-on" href="javascript:downloadtemplate()"><span class="fal fa-download"></span> 下载模板 </a>
                                </div>
                            </div>
                            <div class="btn-group btn-group-sm hidden-xs">
                                <button onclick="exportexcel()" class="btn btn-default"> <span class="fal fa-file-excel mr-1"></span>  导出 </button>
                            </div>

                        </div>

                    </div>

                </div>
                <div class="panel-content">
                    <div class="table-responsive">
                        <table id="companies_datagrid">
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section HeadBlock {
    <link href="~/css/notifications/toastr/toastr.css" rel="stylesheet" />
    <link href="~/css/formplugins/bootstrap-daterangepicker/bootstrap-daterangepicker.css" rel="stylesheet" />
    <link href="~/js/easyui/themes/insdep/easyui.css" rel="stylesheet" asp-append-version="true" />
}
@section ScriptsBlock {
    <script src="~/js/dependency/moment/moment.js" asp-append-version="true"></script>
    <script src="~/js/notifications/toastr/toastr.js"></script>
    <script src="~/js/formplugins/bootstrap-daterangepicker/bootstrap-daterangepicker.js"></script>

    <script src="~/js/easyui/jquery.easyui.min.js" asp-append-version="true"></script>
    <script src="~/js/easyui/plugins/datagrid-filter.js" asp-append-version="true"></script>
    <script src="~/js/easyui/plugins/columns-ext.js" asp-append-version="true"></script>
    <script src="~/js/easyui/plugins/columns-reset.js" asp-append-version="true"></script>
    <script src="~/js/easyui/locale/easyui-lang-zh_CN.js" asp-append-version="true"></script>
    <script src="~/js/easyui/jquery.easyui.component.js" asp-append-version="true"></script>
    <script src="~/js/jquery.extend.formatter.js" asp-append-version="true"></script>

    <script>
        var $dg = $('#companies_datagrid');
        $(document).ready(function () {


            function onClickCell() { }

      //定义datagrid结构
      $dg.datagrid({
        rownumbers: true,
        checkOnSelect: false,
        selectOnCheck: false,
        idField: 'Id',
        sortName: 'Id',
        sortOrder: 'desc',
        remoteFilter: true,
        singleSelect: false,
        url: '/Companies/GetData',
        method: 'get',
        onClickCell: onClickCell,
        clientPaging: false,
        pagination: true,
        striped: true,
        onHeaderContextMenu: function (e, field) {
          e.preventDefault();
          $(this).datagrid('columnMenu').menu('show', {
            left: e.pageX,
            top: e.pageY
          });
        },
        onBeforeLoad: function () {
          const that = $(this);
          document.addEventListener('panel.onfullscreen', () => {
            setTimeout(() => {
              that.datagrid('resize');
            }, 200)
          })
        },
        onLoadSuccess: function (data) {
          editIndex = undefined;
        },
        onCheck: function () {
          $("button[name*='deletebutton']").prop('disabled', false);
        },
        onUncheck: function () {
          const checked = $(this).datagrid('getChecked').length > 0;
          $("button[name*='deletebutton']").prop('disabled', !checked);
        },
        onSelect: function (index, row) {
          company = row;
        },
        onBeginEdit: function (index, row) {
          //const editors = $(this).datagrid('getEditors', index);

        },
        onEndEdit: function (index, row) {

        },
        onBeforeEdit: function (index, row) {
          editIndex = index;
          row.editing = true;
          $("button[name*='deletebutton']").prop('disabled', false);
          $("button[name*='cancelbutton']").prop('disabled', false);
          $("button[name*='savebutton']").prop('disabled', false);
          $(this).datagrid('refreshRow', index);
        },
        onAfterEdit: function (index, row) {
          row.editing = false;
          editIndex = undefined;
          $(this).datagrid('refreshRow', index);
        },
        onCancelEdit: function (index, row) {
          row.editing = false;
          editIndex = undefined;
          $("button[name*='deletebutton']").prop('disabled', true);
          $("button[name*='savebutton']").prop('disabled', true);
          $("button[name*='cancelbutton']").prop('disabled', true);
          $(this).datagrid('refreshRow', index);
        },
        frozenColumns: [[
          /*开启CheckBox选择功能*/
          { field: 'ck', checkbox: true },
          {
            field: 'action',
            title: '操作',
            width: 85,
            sortable: false,
            resizable: true,
            formatter: function showdetailsformatter(value, row, index) {
              if (!row.editing) {
                return `<div class="btn-group">\
                                                         <button onclick="showdetailswindow('${row.Id}',  ${index})" class="btn btn-primary btn-sm btn-icon waves-effect waves-themed" title="查看明细" ><i class="fal fa-edit"></i> </button>\
                                                         <button onclick="deleteRow('${row.Id}',${index})" class="btn btn-primary btn-sm btn-icon waves-effect waves-themed" title="删除记录" ><i class="fal fa-times"></i> </button>\
                                                    </div>`;
              } else {
                return `<button class="btn btn-primary btn-sm btn-icon waves-effect waves-themed" disabled title="查看明细"  ><i class="fal fa-edit"></i> </button>`;
              }
            }
          }
        ]],
        columns: [[
          { /*Id*/
            field: 'Id',
            title: '<span class="required">@Html.DisplayNameFor(model => model.Id)</span>',
            width: 120,
            sortable: true,
            resizable: true,
            hidden: true
          },
          {    /*名称*/
            field: 'Name',
            title: '<span class="required">@Html.DisplayNameFor(model => model.Name)</span>',
            width: 200,
            hidden: false,

            sortable: true,
            resizable: true
          },
          {    /*组织代码*/
            field: 'Code',
            title: '<span class="required">@Html.DisplayNameFor(model => model.Code)</span>',
            width: 120,
            hidden: false,

            sortable: true,
            resizable: true
          },
          {    /*地址*/
            field: 'Address',
            title: '@Html.DisplayNameFor(model => model.Address)',
            width: 200,
            hidden: false,

            sortable: true,
            resizable: true
          },
          {    /*联系人*/
            field: 'Contect',
            title: '@Html.DisplayNameFor(model => model.Contect)',
            width: 120,
            hidden: false,

            sortable: true,
            resizable: true
          },
          {    /*联系电话*/
            field: 'PhoneNumber',
            title: '@Html.DisplayNameFor(model => model.PhoneNumber)',
            width: 120,
            hidden: false,

            sortable: true,
            resizable: true
          },
          {   /*注册日期*/
            field: 'RegisterDate',
            title: '<span class="required">@Html.DisplayNameFor(model => model.RegisterDate)</span>',
            width: 100,
            align: 'right',
            hidden: false,

            formatter: dateformatter,
            sortable: true,
            resizable: true
          },
        ]]
      }).datagrid('columnMoving')
        .datagrid('resetColumns');

      $dg.datagrid('enableFilter', [
        {   /*Id*/
          field: 'Id',
          type: 'numberbox',
          op: ['equal', 'notequal', 'less', 'lessorequal', 'greater', 'greaterorequal']
        },
        {     /*注册日期*/
          field: 'RegisterDate',
          type: 'dateRange',
          options: {
            onChange: value => {
              $dg.datagrid('addFilterRule', {
                field: 'RegisterDate',
                op: 'between',
                value: value
              });

              $dg.datagrid('doFilter');
            }
          }
        },
      ]);




        });
    </script>
}